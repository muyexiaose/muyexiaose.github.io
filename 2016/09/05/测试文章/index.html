
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>数据库性能调优 | 石星的个人博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="muye">
    

    
    <meta name="description" content="数据库调优，就好比盖楼打地基，地基打得不稳，楼层一高，就会塌方。数据库也是如此，数据少，并发小，隐藏的问题是发现不了的，只要达到一定规模后，所有的问题就会全部曝露出来了，所以前期的设计阶段尤为重要。
数据库优化分类
硬件
网络
软件


硬件、网络取决于公司的经济实力。
软件再分为表设计(字段类型、存储引擎)、SQl语句与索引、配置文件参数、体系架构等方面的优化。

表设计优化
一个好的数据库设计">
<meta property="og:type" content="article">
<meta property="og:title" content="数据库性能调优">
<meta property="og:url" content="http://yoursite.com/2016/09/05/测试文章/index.html">
<meta property="og:site_name" content="石星的个人博客">
<meta property="og:description" content="数据库调优，就好比盖楼打地基，地基打得不稳，楼层一高，就会塌方。数据库也是如此，数据少，并发小，隐藏的问题是发现不了的，只要达到一定规模后，所有的问题就会全部曝露出来了，所以前期的设计阶段尤为重要。
数据库优化分类
硬件
网络
软件


硬件、网络取决于公司的经济实力。
软件再分为表设计(字段类型、存储引擎)、SQl语句与索引、配置文件参数、体系架构等方面的优化。

表设计优化
一个好的数据库设计">
<meta property="og:image" content="http://i.imgur.com/Sf9ABub.jpg">
<meta property="og:updated_time" content="2016-09-07T03:32:47.244Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="数据库性能调优">
<meta name="twitter:description" content="数据库调优，就好比盖楼打地基，地基打得不稳，楼层一高，就会塌方。数据库也是如此，数据少，并发小，隐藏的问题是发现不了的，只要达到一定规模后，所有的问题就会全部曝露出来了，所以前期的设计阶段尤为重要。
数据库优化分类
硬件
网络
软件


硬件、网络取决于公司的经济实力。
软件再分为表设计(字段类型、存储引擎)、SQl语句与索引、配置文件参数、体系架构等方面的优化。

表设计优化
一个好的数据库设计">
<meta name="twitter:image" content="http://i.imgur.com/Sf9ABub.jpg">

    
    <link rel="alternative" href="/atom.xml" title="石星的个人博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="石星的个人博客" title="石星的个人博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="石星的个人博客">石星的个人博客</a></h1>
				<h2 class="blog-motto">爱生活爱编码</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/tags">标签</a></li>
					
						<li><a href="/categories">分类</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/05/测试文章/" title="数据库性能调优" itemprop="url">数据库性能调优</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="muye" target="_blank" itemprop="author">muye</a>
		
  <p class="article-time">
    <time datetime="2016-09-05T13:31:42.000Z" itemprop="datePublished"> 发表于 2016-09-05</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据库优化分类"><span class="toc-number">1.</span> <span class="toc-text">数据库优化分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#表设计优化"><span class="toc-number">1.1.</span> <span class="toc-text">表设计优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#表优化的常用方法"><span class="toc-number">1.2.</span> <span class="toc-text">表优化的常用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字段类型的选取"><span class="toc-number">1.3.</span> <span class="toc-text">字段类型的选取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串类型总结"><span class="toc-number">1.4.</span> <span class="toc-text">字符串类型总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#采用合适的锁机制"><span class="toc-number">1.5.</span> <span class="toc-text">采用合适的锁机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#表锁特点"><span class="toc-number">1.6.</span> <span class="toc-text">表锁特点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#表锁特点实验"><span class="toc-number">1.6.0.1.</span> <span class="toc-text">表锁特点实验</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#读锁阻塞写锁"><span class="toc-number">1.6.0.1.1.</span> <span class="toc-text">读锁阻塞写锁</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#写锁阻塞读-写锁"><span class="toc-number">1.6.0.2.</span> <span class="toc-text">写锁阻塞读/写锁</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#行锁的特点-行锁只会锁住当前修改的行"><span class="toc-number">1.7.</span> <span class="toc-text">行锁的特点( 行锁只会锁住当前修改的行 )</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#行锁使用情况"><span class="toc-number">1.7.1.</span> <span class="toc-text">行锁使用情况</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#实验-验证行锁只会影响到对应行，而不是整个表"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">实验(验证行锁只会影响到对应行，而不是整个表)</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#InnoDB引擎与MyISAM引擎对比"><span class="toc-number">2.</span> <span class="toc-text">InnoDB引擎与MyISAM引擎对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何选择表引擎"><span class="toc-number">3.</span> <span class="toc-text">如何选择表引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL优化与合理利用索引"><span class="toc-number">4.</span> <span class="toc-text">SQL优化与合理利用索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#如何定位执行很慢的SQL语句"><span class="toc-number">4.1.</span> <span class="toc-text">如何定位执行很慢的SQL语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句优化建议"><span class="toc-number">4.2.</span> <span class="toc-text">SQL语句优化建议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引"><span class="toc-number">5.</span> <span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#合理使用索引"><span class="toc-number">5.1.</span> <span class="toc-text">合理使用索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#索引常见用法"><span class="toc-number">5.2.</span> <span class="toc-text">索引常见用法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#用不到索引的情况"><span class="toc-number">5.2.1.</span> <span class="toc-text">用不到索引的情况</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何写出高效的SQL语句"><span class="toc-number">6.</span> <span class="toc-text">如何写出高效的SQL语句</span></a></li></ol>
		
		</div>
		
		<p>数据库调优，就好比盖楼打地基，地基打得不稳，楼层一高，就会塌方。数据库也是如此，数据少，并发小，隐藏的问题是发现不了的，只要达到一定规模后，所有的问题就会全部曝露出来了，所以前期的设计阶段尤为重要。</p>
<h2 id="数据库优化分类"><a href="#数据库优化分类" class="headerlink" title="数据库优化分类"></a>数据库优化分类</h2><ul>
<li>硬件</li>
<li>网络</li>
<li>软件</li>
</ul>
<blockquote>
<p>硬件、网络取决于公司的经济实力。</p>
<p>软件再分为表设计(字段类型、存储引擎)、SQl语句与索引、配置文件参数、体系架构等方面的优化。</p>
</blockquote>
<h3 id="表设计优化"><a href="#表设计优化" class="headerlink" title="表设计优化"></a>表设计优化</h3><blockquote>
<p>一个好的数据库设计对于数据库的性能优化常常会起到事半功倍的效果。合理的数据库结构不仅可以使数据库占用更小的磁盘空间，而且能够使查询速度更快。</p>
</blockquote>
<h3 id="表优化的常用方法"><a href="#表优化的常用方法" class="headerlink" title="表优化的常用方法"></a>表优化的常用方法</h3><ul>
<li>将字段很多的表分解成多个表</li>
</ul>
<blockquote>
<p>对于字段较多的表，如果有些字段的使用频率很低，可以将这些字段分离出来形成新表。因为当一个表的数据量很大的时候，会由于使用频率低的字段的存在而变慢。</p>
</blockquote>
<ul>
<li>增加冗余字段</li>
</ul>
<blockquote>
<p>设计数据库表时应尽量遵守范式理论的约定，尽可能减少冗余字段。但是合理地加入冗余字段也可以提高查询速度。这就是以空间换时间。</p>
</blockquote>
<p>总结：在开发应用程序时，设计的数据库要最大程度地遵守三范式。但是，三范式最大的问题在于通常需要join很多表，而这个会导致查询效率很低。<span style="color:red">所以有时候基于性能考虑</span>，我们需要有意违反三范式，适度的冗余，以达到提高查询效率的目的。</p>
<h3 id="字段类型的选取"><a href="#字段类型的选取" class="headerlink" title="字段类型的选取"></a>字段类型的选取</h3><blockquote>
<p>原则：选择字段的一般原则是保小不保大，能用占用字节少的字段就不用大字段。</p>
</blockquote>
<ul>
<li>数字类型<br><img src="http://i.imgur.com/Sf9ABub.jpg" alt=""><br>tinyint类型最大存储是255。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">create table tmp(id tinyint);</div><div class="line">insert into tmp(id) values(256);//溢出</div></pre></td></tr></table></figure>
<ul>
<li>int(11) vs int(21) 存储空间还是存储范围有区别？ int(11)与int(21)的存储空间与存储范围是一样的。<blockquote>
<p>区别是：如果你选择是int(11)，那么你存放了一个1，那么结果是1前面有10个0，int(21)前面有20个零</p>
</blockquote>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">实验：</div><div class="line">    create table t(a int(11) zerofill,b int(21) zerofill);//zerofill 是补全零的</div><div class="line"></div><div class="line">    insert into t values(1,1);</div><div class="line"></div><div class="line">    select * from t;</div><div class="line"></div><div class="line">    +-------------+-----------------------+</div><div class="line">    | a           | b                     |</div><div class="line">    +-------------+-----------------------+</div><div class="line">    | 00000000001 | 000000000000000000001 |</div><div class="line">    +-------------+-----------------------+</div><div class="line">    1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</div></pre></td></tr></table></figure>
<p>字符串类型 * char</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">char存储定长，容易造成空间的浪费。char数据类型存储大小最大为255字符。</div><div class="line"></div><div class="line">最大255个字符的意思是最大只能存放255个字母或者255个汉字</div></pre></td></tr></table></figure>
<ul>
<li><p>varchar</p>
<p>  varchar存储变长，节省存储空间,varchar需要一位来存储长度。varchar是使用多少，就使用多少空间。所以通常都是选择varchar。</p>
<p>  varchar数据类型可以存储超过255个字符</p>
<p>  注意：char和varchar存储单位为字符。字符与字节需要换算。</p>
<p>  实验： //char最大长度255字符，所以报错 mysql&gt; create table c(a char(256));</p>
</li>
<li><p>字符与字节的关系</p>
<p>  如果是utf8字符集，因为utf8存放中文占用三个字节大小，所以存放两个中文需要6个字节大小。</p>
<p>  一个英语字母无论什么情况下都是占用一个字节的，所以varchar(6)就可以存放github这个英语单词了</p>
</li>
<li><p>date</p>
<p>  date三个字节，如2015-05-01只能存储到天数。date精确到年月日</p>
</li>
<li><p>time</p>
<p>  time三个字节,只能存小时分钟，time精确到小时分钟秒</p>
</li>
<li><p>datetime</p>
<p>  datetime八字节，可以存储年月日时分秒</p>
</li>
<li><p>timestamp</p>
<p>  timestamp四字节，可以存储年月日时分秒。</p>
</li>
</ul>
<h3 id="字符串类型总结"><a href="#字符串类型总结" class="headerlink" title="字符串类型总结"></a>字符串类型总结</h3><blockquote>
<p>char与varchar定义的长度是字符长度不是字节长度<br>存储字符串推荐选择使用varchar(n),n尽量小</p>
</blockquote>
<h3 id="采用合适的锁机制"><a href="#采用合适的锁机制" class="headerlink" title="采用合适的锁机制"></a>采用合适的锁机制</h3><ul>
<li><p>MySQL的锁有以下几种形式：</p>
<ul>
<li>表级锁：开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率高，并发度最低。MyISAM属于这种类型。</li>
<li>行级锁：开销大，加锁慢；会出现死锁；锁定粒度小，发生锁冲突的概率小，并发度最高。InnoDB就是行锁。</li>
</ul>
</li>
</ul>
<h3 id="表锁特点"><a href="#表锁特点" class="headerlink" title="表锁特点"></a>表锁特点</h3><blockquote>
<p>MyISAM存储引擎只支持表锁，所以对MyISAM表进行操作，会存在以下情况：</p>
</blockquote>
<ul>
<li>对MyISAM表的读操作，不会阻塞其他进程对同一个表的读请求，但会阻塞对同一个表写请求。只有当读锁释放后，才会执行其他进程的写操作。</li>
<li>对MyISAM表的写操作，会阻塞其他进程对同一个表的读和写操作，只有当写锁释放后，才会执行其他进程的读写操作。</li>
</ul>
<h5 id="表锁特点实验"><a href="#表锁特点实验" class="headerlink" title="表锁特点实验"></a>表锁特点实验</h5><h6 id="读锁阻塞写锁"><a href="#读锁阻塞写锁" class="headerlink" title="读锁阻塞写锁"></a>读锁阻塞写锁</h6><ul>
<li><p>准备一个千万级的数据表    </p>
<pre><code>create table t2(id int primary key auto_increment,
name varchar(20))engine=myisam;

insert into t2(name) values(&apos;a&apos;),(&apos;b&apos;),(&apos;c&apos;);

insert into t2(name) select name from t2;//这条语句重复n次后就有很多数据
</code></pre></li>
<li><p>当正在读myisam，同时不能写</p>
<blockquote>
<p>select * from t2;</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>update t2 set name= ‘liangzhi’ where id = 1;</p>
</blockquote>
<p><span style="color:red">更新语句，只有等查询语句执行结束后才可以执行，也就是说读锁释放后，才能进行写操作。否则一直在等待状态。</span></p>
<h5 id="写锁阻塞读-写锁"><a href="#写锁阻塞读-写锁" class="headerlink" title="写锁阻塞读/写锁"></a>写锁阻塞读/写锁</h5><blockquote>
<p>update t2 set name=’gz’ where id &gt; 1000;</p>
</blockquote>
<p>这个时候，t2已经加了写锁，这个时候，去执行查询。也是只能等待写锁释放。</p>
<blockquote>
<p>select * from t2 limit 1;</p>
</blockquote>
<h3 id="行锁的特点-行锁只会锁住当前修改的行"><a href="#行锁的特点-行锁只会锁住当前修改的行" class="headerlink" title="行锁的特点( 行锁只会锁住当前修改的行 )"></a>行锁的特点( 行锁只会锁住当前修改的行 )</h3><blockquote>
<p>InnoDB存储引擎是通过索引上的索引项加锁来实现的，这就意味着：只有通过索引条件检索数据，InnoDB才会使用行级锁。否则，InnoDB将使用表锁。</p>
</blockquote>
<h4 id="行锁使用情况"><a href="#行锁使用情况" class="headerlink" title="行锁使用情况"></a>行锁使用情况</h4><h5 id="实验-验证行锁只会影响到对应行，而不是整个表"><a href="#实验-验证行锁只会影响到对应行，而不是整个表" class="headerlink" title="实验(验证行锁只会影响到对应行，而不是整个表)"></a>实验(验证行锁只会影响到对应行，而不是整个表)</h5><pre><code>只有条件走索引才能实现行级锁,否则加表锁的实例

A连接：

create table t3(a int ,b int)engine=innodb default charset=utf8;

insert into t3 values(1,1);

insert into t3 values(1,6);

insert into t3 values(1,10);

begin;

//for update 就是加锁   意图给a=1 b = 6 加锁  
select * from t3 where a= 1 and b =6 for update;


B连接：

begin;

//发现也无法查询，因为a中没有索引，所以只有条件走索引才能实现行级锁,否则加表锁
select * from t3 where a= 1 and b = 10 for update;

另外一个实验：

create table t4(a int ,b int,key in_a(a))engine=innodb default charset=utf8;

    insert into t4 values(1,1);

insert into t4 values(1,6);

insert into t4 values(1,10);

begin;

//for update 就是加锁   意图给a=1 b = 6 加锁  
select * from t4 where a= 1 and b =6 for update;


B连接：

begin;

//发现也无法查询，因为a中没有索引，所以只有条件走索引才能实现行级锁,否则加表锁
select * from t4 where a= 1 and b = 10 for update;
</code></pre><h2 id="InnoDB引擎与MyISAM引擎对比"><a href="#InnoDB引擎与MyISAM引擎对比" class="headerlink" title="InnoDB引擎与MyISAM引擎对比"></a>InnoDB引擎与MyISAM引擎对比</h2><ul>
<li><p>事务支持</p>
<p>  MyISAM是非事务安全型的，而InnoDB是事务安全型的，也就是支持事务</p>
</li>
<li><p>锁机制</p>
<p>  MyISAM锁是表锁，锁开销最小，而InnoDB支持行锁，锁管理开销大，支持更好的并发写操作。</p>
</li>
<li><p>文件保存形式</p>
<p>  每张MyISAM表存放在3个文件中：frm文件存放表格存放，数据文件是MYD，索引文件是MYI</p>
</li>
<li><p>数据安全性<br>  InnoDB表比MyISAM表更安全，因为InnoDB具有崩溃恢复能力。</p>
</li>
</ul>
<h2 id="如何选择表引擎"><a href="#如何选择表引擎" class="headerlink" title="如何选择表引擎"></a>如何选择表引擎</h2><blockquote>
<p>InnoDB支持行锁、事务。如果应用中需要执行大量的读写操作，应该选择InnoDB，这样可以提高多用户并发操作的性能。在MySQL5.5之后版本，Oracle已经很少支持MyISAM了，所以建议优先选择InnoDB引擎。</p>
</blockquote>
<hr>
<hr>
<hr>
<h2 id="SQL优化与合理利用索引"><a href="#SQL优化与合理利用索引" class="headerlink" title="SQL优化与合理利用索引"></a>SQL优化与合理利用索引</h2><p>系统优化中一个很重要的方面就是SQL语句的优化。对于海量数据，劣质SQL语句和高效SQL语句之间的速度差别可以达到上百倍。</p>
<h3 id="如何定位执行很慢的SQL语句"><a href="#如何定位执行很慢的SQL语句" class="headerlink" title="如何定位执行很慢的SQL语句"></a>如何定位执行很慢的SQL语句</h3><p><span style="color:red">开启慢查询日志的好处是可以通过记录、分析慢SQL语句来优化SQL语句</span></p>
<p>开启慢查询日志，在my.cnf配置文件中，加入以下参数：</p>
<pre><code>slow_query_log = 1
slow_query_log_file = mysql.slow
long_query_time = 0.05        # 超过1秒的SQL会记录下来
</code></pre><h3 id="SQL语句优化建议"><a href="#SQL语句优化建议" class="headerlink" title="SQL语句优化建议"></a>SQL语句优化建议</h3><ul>
<li>避免使用子查询，可以用left join表连接替换</li>
<li><p>limit分页优化</p>
<p>  传统的分页：select SQL_NO_CACHE * from t2 order by id limit 99999,10;</p>
<p>  传统的的分页，虽然用上了id索引，但要从第一行开始起定位到99999行，然后再扫描出后10行，相当于进行一个全表扫描，显然效率不高。</p>
<p>  优化方法：</p>
<p>  select SQL_NO_CACHE * from t2 where id &gt;= 100000 order by id limit 10;</p>
<p>  优化方法利用id索引直接定位100000行，然后再扫描出后10行。速度相当快。</p>
</li>
<li><p>避免使用*号，只查需要的字段</p>
</li>
<li>多使用limit，减少数据传输</li>
</ul>
<pre><code>用户查看所有的数据。  ajax异步请求。
</code></pre><ul>
<li>可以使用冗余来减少关联表查询</li>
<li>给常在where条件后的字段添加索引，并且合理使用索引</li>
</ul>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>分类：主键索引、唯一索引、普通索引、全文索引</p>
<h3 id="合理使用索引"><a href="#合理使用索引" class="headerlink" title="合理使用索引"></a>合理使用索引</h3><p>适当的索引对应用的性能来说相当重要，而且也建议在MySQL中使用索引，它的速度是很快的。</p>
<p>但是索引也是有成本的。<span style="color:red">每次向表中写入时，如果带有一个或多个索引，那么MySQL也要更新各个索引。索引还增加了数据库的规模，也就是说索引也是占据空间的。</span></p>
<p>只有当某列被用于where子句时，才能享受索引性能提升的好处。如果不使用索引，它就没有价值，而且会带来维护上的开销。</p>
<h3 id="索引常见用法"><a href="#索引常见用法" class="headerlink" title="索引常见用法"></a>索引常见用法</h3><ul>
<li><p>依据where查询条件建立索引</p>
<pre><code>select a,b from tab_a where c = ? //应该给c建立索引
</code></pre></li>
<li><p>使用联合索引，而不是多个单列索引</p>
<pre><code>select * from tab where a = ? and b =?
//给(a,b)建立联合索引，而不是分别给a,b建立索引
</code></pre></li>
<li><p>联合索引中索引字段的顺序根据区分度排，区分度大的放在前面</p>
<pre><code>//(name,sex);//将name放前面，因为name的区分度更大。因为sex只有0 1 2 这个三个值。
</code></pre></li>
</ul>
<ul>
<li><p>合理创建联合索引，避免冗余</p>
<pre><code>//(a),(a,b),(a,b,c)只要给(a,b,c)建立索引就行
</code></pre></li>
<li>order by 、group by 、 distrinct字段添加索引</li>
</ul>
<h4 id="用不到索引的情况"><a href="#用不到索引的情况" class="headerlink" title="用不到索引的情况"></a>用不到索引的情况</h4><ul>
<li><p>字段使用函数，将不能用到索引(<strong><em>**</em></strong>)</p>
<pre><code>select createtime from aa where date(createtime) = curdate();

//where后面的字段(createtime)使用函数,将不会使用到索引。
</code></pre></li>
<li><p>用数字当字符类型，数字一定要加引号</p>
<pre><code>select * from user where name = 123 //这SQL语句用不到name索引

select * from user where name = &apos;123&apos; //这样写才会用到name字段上的索引
</code></pre></li>
<li><p>在使用like关键字进行查询的语句中，如果匹配字符串的第一个字符为”%”，索引不会起作用(<em>**</em>)。</p>
<pre><code>    //用不到索引的        
 desc select *  from t where name like &quot;%j%&quot;\G;

//用到索引
 desc select *  from t where name like &quot;j%&quot;\G;
</code></pre></li>
</ul>
<ul>
<li><p>联合索引，只有查询条件中使用了这些字段中第一个字段时，索引才会被使用</p>
<pre><code>//建立了一个联合索引
create index in_name on user(name,email);

explain select * from user where name = &apos;jack&apos;; //用到索引
explain select * from user where email = &apos;jack@qq.com&apos;; //用不到索引
</code></pre></li>
<li><p>使用OR关键字的查询语句(<strong>*</strong>) </p>
<ul>
<li>查询语句的查询条件中只有OR关键字，且OR前后的两个条件中的列都是索引时，查询中才使用索引。否则查询将不使用索引。</li>
</ul>
</li>
<li><p>order by 的字段混合使用asc和desc用不到索引</p>
<pre><code>select * from user order by id desc,name asc;
</code></pre></li>
<li><p>where 子句使用的字段和order by 的字段不一致</p>
<pre><code>select * from user where name = &apos;jack&apos; order by id;
</code></pre></li>
<li><p>对不同关键字使用order by 排序</p>
<pre><code>select * from user order by name,id;
</code></pre></li>
</ul>
<h2 id="如何写出高效的SQL语句"><a href="#如何写出高效的SQL语句" class="headerlink" title="如何写出高效的SQL语句"></a>如何写出高效的SQL语句</h2><ol>
<li><p>合理地使用索引，给经常在where条件后的字段添加索引。</p>
</li>
<li><p>不要使用子查询,因为子查询速度很慢。</p>
</li>
<li><p>尽量减少使用*，需要什么查什么。节约数据库IO消耗</p>
</li>
<li><p>多使用Limit，减少数据传输</p>
</li>
<li><p>可以使用冗余来减少关联表查询</p>
</li>
<li><p>尽量不要在数据库中做运算(+-/*)</p>
</li>
<li><p>尽量减少使用MySQL内置函数 </p>
</li>
<li><p>所有的SQL关键字用大写，避免SQL语句重复编译造成系统资源的浪费</p>
</li>
<li><p>最先出现的条件，一定是过滤和排除掉更多结果的条件，第二出现的次<br>之。</p>
</li>
</ol>
<pre><code>select * from user where id &gt; 1  and sex = 1;

    select * from user where sex = 1  and  id &gt; 1  //这条语句更加好
</code></pre><ol>
<li>使用预处理语句。例如使用PDO来操作mysql</li>
</ol>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/blog/">blog</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/mysql/">mysql</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2016/09/05/测试文章/" data-title="数据库性能调优 | 石星的个人博客" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/09/12/redis应用/" title="redis在php下的安装与应用">
  <strong>上一篇：</strong><br/>
  <span>
  redis在php下的安装与应用</span>
</a>
</div>


</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/09/05/测试文章/" data-title="数据库性能调优" data-url="http://yoursite.com/2016/09/05/测试文章/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据库优化分类"><span class="toc-number">1.</span> <span class="toc-text">数据库优化分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#表设计优化"><span class="toc-number">1.1.</span> <span class="toc-text">表设计优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#表优化的常用方法"><span class="toc-number">1.2.</span> <span class="toc-text">表优化的常用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字段类型的选取"><span class="toc-number">1.3.</span> <span class="toc-text">字段类型的选取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串类型总结"><span class="toc-number">1.4.</span> <span class="toc-text">字符串类型总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#采用合适的锁机制"><span class="toc-number">1.5.</span> <span class="toc-text">采用合适的锁机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#表锁特点"><span class="toc-number">1.6.</span> <span class="toc-text">表锁特点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#表锁特点实验"><span class="toc-number">1.6.0.1.</span> <span class="toc-text">表锁特点实验</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#读锁阻塞写锁"><span class="toc-number">1.6.0.1.1.</span> <span class="toc-text">读锁阻塞写锁</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#写锁阻塞读-写锁"><span class="toc-number">1.6.0.2.</span> <span class="toc-text">写锁阻塞读/写锁</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#行锁的特点-行锁只会锁住当前修改的行"><span class="toc-number">1.7.</span> <span class="toc-text">行锁的特点( 行锁只会锁住当前修改的行 )</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#行锁使用情况"><span class="toc-number">1.7.1.</span> <span class="toc-text">行锁使用情况</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#实验-验证行锁只会影响到对应行，而不是整个表"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">实验(验证行锁只会影响到对应行，而不是整个表)</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#InnoDB引擎与MyISAM引擎对比"><span class="toc-number">2.</span> <span class="toc-text">InnoDB引擎与MyISAM引擎对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何选择表引擎"><span class="toc-number">3.</span> <span class="toc-text">如何选择表引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL优化与合理利用索引"><span class="toc-number">4.</span> <span class="toc-text">SQL优化与合理利用索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#如何定位执行很慢的SQL语句"><span class="toc-number">4.1.</span> <span class="toc-text">如何定位执行很慢的SQL语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句优化建议"><span class="toc-number">4.2.</span> <span class="toc-text">SQL语句优化建议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引"><span class="toc-number">5.</span> <span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#合理使用索引"><span class="toc-number">5.1.</span> <span class="toc-text">合理使用索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#索引常见用法"><span class="toc-number">5.2.</span> <span class="toc-text">索引常见用法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#用不到索引的情况"><span class="toc-number">5.2.1.</span> <span class="toc-text">用不到索引的情况</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何写出高效的SQL语句"><span class="toc-number">6.</span> <span class="toc-text">如何写出高效的SQL语句</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://edu.csdn.net/" target="_blank" title="CSDN">CSDN</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.cnblogs.com/txw1958/p/wechat-tutorial.html" target="_blank" title="微信学习">微信学习</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.tuling123.com/openapi/cloud/home.jsp" target="_blank" title="图灵机器人">图灵机器人</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.bootcss.com/" target="_blank" title="Bootstrap中文网">Bootstrap中文网</a>
            
          </li>
        
          <li>
            
            	<a href="http://validform.rjboy.cn/" target="_blank" title="表单验证">表单验证</a>
            
          </li>
        
          <li>
            
            	<a href="http://oss.org.cn/man/develop/rfc/default.htm" target="_blank" title="收集了有关互联网相关信息">RFC</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="muye">muye</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"东方草原上的孤狼"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
